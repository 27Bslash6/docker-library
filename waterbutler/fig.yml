# Data Containers

osfstoragedata:
    image: busybox:latest
    volumes:
        - .data/osfstorage/pending:/data/osfstorage/pending
        - .data/osfstorage/complete:/data/osfstorage/complete

rabbitmqdata:
    image: busybox:latest
    volumes:
        - .data/rabbitmq:/var/lib/rabbitmq

redisdata:
    image: busybox:latest
    volumes:
        - .data/redis/data:/data

# Service Containers

redis:
    build: ./redis
    volumes_from:
        - redisdata

rabbitmq:
    build: ./rabbitmq
    hostname: waterbutler_rabbitmq_1
    environment:
        - RABBITMQ_NODENAME=waterbutler
    links:
        - redis
    volumes_from:
        - rabbitmqdata

celery:
    build: ./celery
    links:
        - rabbitmq

# Server Containers

tornado:
    build: ./tornado
    environment:
        - ENV=docker
        - SOURCE_BRANCH=develop
        - SOURCE_REPO=https://github.com/CenterForOpenScience/waterbutler
    links:
        - rabbitmq
    ports:
        - "7777:7777"
    volumes:
        - ~/.cos/waterbutler-docker.json:/home/tornado/.cos/waterbutler-docker.json:ro
        - /data/osfstorage/pending
        - /data/osfstorage/complete
    volumes_from:
        - osfstoragedata
